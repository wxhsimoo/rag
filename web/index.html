<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>文件管理与索引构建</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header>
    <h1>文件管理与索引构建</h1>
    <div class="env">
      <label for="baseUrl">后端地址：</label>
      <input id="baseUrl" type="text" value="http://localhost:8000" />
      <button id="applyBaseUrl">应用</button>
    </div>
  </header>

  <main>
    <div class="tabs">
      <button id="tabManage" class="tab active">管理与索引</button>
      <button id="tabQA" class="tab">问答</button>
    </div>

    <!-- 管理与索引 Tab 面板 -->
    <section id="panelManage" class="tab-panel">
      <div class="section-header">
        <h2>文件管理</h2>
        <div class="actions">
          <button id="refreshListBtn">刷新列表</button>
          <button id="initIndexBtn" class="primary">构建索引</button>
        </div>
      </div>

      <div class="upload">
        <h3>上传文件</h3>
        <form id="uploadForm">
          <div class="form-row">
            <label for="fileInput">选择文件：</label>
            <input id="fileInput" type="file" required />
          </div>
          <div class="form-row">
            <label for="docType">文档类型（可选）：</label>
            <input id="docType" type="text" placeholder="例如 .txt/.md/.pdf" />
          </div>
          <div class="form-row">
            <label for="sourcePath">保存文件名（可选）：</label>
            <input id="sourcePath" type="text" placeholder="默认使用上传文件名" />
          </div>
          <div class="form-row">
            <label for="metadata">元数据 JSON（可选）：</label>
            <textarea id="metadata" rows="4" placeholder='例如 {"category": "knowledge"}'></textarea>
          </div>
          <div class="form-row">
            <button type="submit" class="primary">上传</button>
          </div>
        </form>
      </div>

      <div class="table-wrapper">
        <table id="filesTable">
          <thead>
            <tr>
              <th>文档ID</th>
              <th>文件名</th>
              <th>大小(字节)</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- 动态填充 -->
          </tbody>
        </table>
      </div>

      <div class="section-header">
        <h2>索引结果</h2>
      </div>
      <div class="table-wrapper">
        <table id="indexResultTable">
          <thead>
            <tr>
              <th>字段</th>
              <th>值</th>
            </tr>
          </thead>
          <tbody>
            <!-- 动态填充：显示 /index/init 的返回结果 -->
          </tbody>
        </table>
      </div>

      <div class="table-wrapper" id="docDetailWrapper" style="display:none;">
        <h3>文档详情</h3>
        <table id="docDetailTable">
          <thead>
            <tr>
              <th>字段</th>
              <th>值</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- 问答 Tab 面板 -->
    <section id="panelQA" class="tab-panel hidden">
      <div class="section-header">
        <h2>问答</h2>
      </div>

      <div class="upload">
        <h3>提问</h3>
        <form id="qaForm">
          <div class="form-row">
            <label for="qaQuestion">问题：</label>
            <textarea id="qaQuestion" rows="4" placeholder="请输入你的问题" required></textarea>
          </div>
          <div class="form-row">
            <label for="qaTopK">Top K（可选）：</label>
            <input id="qaTopK" type="number" min="1" max="20" value="5" />
          </div>
          <div class="form-row">
            <label for="qaSessionId">会话ID（可选）：</label>
            <input id="qaSessionId" type="text" placeholder="例如 session-001" />
          </div>
          <div class="form-row">
            <button type="submit" class="primary">发送</button>
          </div>
        </form>
      </div>

      <div class="table-wrapper">
        <h3>输出</h3>
        <table>
          <thead>
            <tr>
              <th>类型</th>
              <th>内容</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>用户提问</td>
              <td id="qaOutputQuestion" class="mono"></td>
            </tr>
            <tr>
              <td>系统响应</td>
              <td id="qaOutputAnswer" class="mono"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="table-wrapper" id="qaSourcesWrapper" style="display:none;">
        <h3>来源文档</h3>
        <table>
          <thead>
            <tr>
              <th>文档ID</th>
              <th>分数</th>
              <th>摘要</th>
            </tr>
          </thead>
          <tbody id="qaSourcesBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <span>前端独立项目，调用后端 API：/documents, /index/init</span>
  </footer>

  <script src="./app.js"></script>
</body>
</html>